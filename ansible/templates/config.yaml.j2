# ByteFreezer Proxy Configuration
# Generated by Ansible on {{ ansible_date_time.iso8601 }}
# Host: {{ inventory_hostname }}

app:
  name: {{ (bytefreezer_proxy_config.app.name | default(bytefreezer_proxy_default_config.app.name)) }}
  version: {{ (bytefreezer_proxy_config.app.version | default(bytefreezer_proxy_default_config.app.version)) }}

# Logging configuration
logging:
  level: {{ (bytefreezer_proxy_config.logging.level | default(bytefreezer_proxy_default_config.logging.level)) }}
  encoding: {{ (bytefreezer_proxy_config.logging.encoding | default(bytefreezer_proxy_default_config.logging.encoding)) }}

# API server configuration  
server:
  api_port: {{ (bytefreezer_proxy_config.server.api_port | default(bytefreezer_proxy_default_config.server.api_port)) }}

# UDP listener configuration
udp:
  enabled: {{ (bytefreezer_proxy_config.udp.enabled | default(bytefreezer_proxy_default_config.udp.enabled)) | lower }}
  host: "{{ (bytefreezer_proxy_config.udp.host | default(bytefreezer_proxy_default_config.udp.host)) }}"
  read_buffer_size_bytes: {{ (bytefreezer_proxy_config.udp.read_buffer_size_bytes | default(bytefreezer_proxy_default_config.udp.read_buffer_size_bytes)) }}
  max_batch_lines: {{ (bytefreezer_proxy_config.udp.max_batch_lines | default(bytefreezer_proxy_default_config.udp.max_batch_lines)) }}
  max_batch_bytes: {{ (bytefreezer_proxy_config.udp.max_batch_bytes | default(bytefreezer_proxy_default_config.udp.max_batch_bytes)) }}
  batch_timeout_seconds: {{ (bytefreezer_proxy_config.udp.batch_timeout_seconds | default(bytefreezer_proxy_default_config.udp.batch_timeout_seconds)) }}
  enable_compression: {{ (bytefreezer_proxy_config.udp.enable_compression | default(bytefreezer_proxy_default_config.udp.enable_compression)) | lower }}
  compression_level: {{ (bytefreezer_proxy_config.udp.compression_level | default(bytefreezer_proxy_default_config.udp.compression_level)) }}
  
  # Multiple port configuration with dataset mapping
  listeners:
{% for listener in (bytefreezer_proxy_config.udp.listeners | default(bytefreezer_proxy_default_config.udp.listeners)) %}
    - port: {{ listener.port }}
      dataset_id: "{{ listener.dataset_id }}"
{% if listener.tenant_id is defined %}
      tenant_id: "{{ listener.tenant_id }}"
{% endif %}
{% endfor %}

# Global tenant configuration
tenant_id: "{{ (bytefreezer_proxy_config.tenant_id | default(bytefreezer_proxy_default_config.tenant_id)) }}"
bearer_token: "{{ (bytefreezer_proxy_config.bearer_token | default(bytefreezer_proxy_default_config.bearer_token)) }}"

# Bytefreezer-receiver configuration
receiver:
  base_url: "{{ (bytefreezer_proxy_config.receiver.base_url | default(bytefreezer_proxy_default_config.receiver.base_url)) }}"
  timeout_seconds: {{ (bytefreezer_proxy_config.receiver.timeout_seconds | default(bytefreezer_proxy_default_config.receiver.timeout_seconds)) }}
  retry_count: {{ (bytefreezer_proxy_config.receiver.retry_count | default(bytefreezer_proxy_default_config.receiver.retry_count)) }}
  retry_delay_seconds: {{ (bytefreezer_proxy_config.receiver.retry_delay_seconds | default(bytefreezer_proxy_default_config.receiver.retry_delay_seconds)) }}

# SOC alerting configuration
soc:
  enabled: {{ (bytefreezer_proxy_config.soc.enabled | default(bytefreezer_proxy_default_config.soc.enabled)) | lower }}
  endpoint: "{{ (bytefreezer_proxy_config.soc.endpoint | default(bytefreezer_proxy_default_config.soc.endpoint)) }}"
  timeout: {{ (bytefreezer_proxy_config.soc.timeout | default(bytefreezer_proxy_default_config.soc.timeout)) }}

# OpenTelemetry configuration
otel:
  enabled: {{ (bytefreezer_proxy_config.otel.enabled | default(bytefreezer_proxy_default_config.otel.enabled)) | lower }}
  endpoint: "{{ (bytefreezer_proxy_config.otel.endpoint | default(bytefreezer_proxy_default_config.otel.endpoint)) }}"
  service_name: "{{ (bytefreezer_proxy_config.otel.service_name | default(bytefreezer_proxy_default_config.otel.service_name)) }}"
  scrapeIntervalseconds: {{ (bytefreezer_proxy_config.otel.scrapeIntervalseconds | default(bytefreezer_proxy_default_config.otel.scrapeIntervalseconds)) }}

# Housekeeping configuration
housekeeping:
  enabled: {{ (bytefreezer_proxy_config.housekeeping.enabled | default(bytefreezer_proxy_default_config.housekeeping.enabled)) | lower }}
  intervalseconds: {{ (bytefreezer_proxy_config.housekeeping.intervalseconds | default(bytefreezer_proxy_default_config.housekeeping.intervalseconds)) }}

# Local spooling for failed uploads
spooling:
  enabled: {{ (bytefreezer_proxy_config.spooling.enabled | default(bytefreezer_proxy_default_config.spooling.enabled)) | lower }}
  directory: "{{ (bytefreezer_proxy_config.spooling.directory | default(bytefreezer_proxy_default_config.spooling.directory)) }}"
  max_size_bytes: {{ (bytefreezer_proxy_config.spooling.max_size_bytes | default(bytefreezer_proxy_default_config.spooling.max_size_bytes)) }}
  retry_attempts: {{ (bytefreezer_proxy_config.spooling.retry_attempts | default(bytefreezer_proxy_default_config.spooling.retry_attempts)) }}
  retry_interval_seconds: {{ (bytefreezer_proxy_config.spooling.retry_interval_seconds | default(bytefreezer_proxy_default_config.spooling.retry_interval_seconds)) }}
  cleanup_interval_seconds: {{ (bytefreezer_proxy_config.spooling.cleanup_interval_seconds | default(bytefreezer_proxy_default_config.spooling.cleanup_interval_seconds)) }}

# Development mode
dev: {{ (bytefreezer_proxy_config.dev | default(bytefreezer_proxy_default_config.dev)) | lower }}